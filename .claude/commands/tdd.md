---
name: tdd
description: æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰æµç¨‹åŠ©æ‰‹
version: 0.0.3
tags:
  - testing
  - tdd
  - workflow
  - git
dependencies:
  git: "any"
---

# TDD ç¼–ç¨‹æ¨¡å¼

> **å¿«é€Ÿåé¦ˆæ˜¯ TDD çš„æ ¸å¿ƒ**

ä¸¥æ ¼éµå¾ªæµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTest-Driven Developmentï¼‰æµç¨‹ï¼šçº¢ â†’ ç»¿ â†’ é‡æ„ã€‚

---

## 1. TDD å¾ªç¯

### 1.1 ğŸ”´ çº¢ - ç¼–å†™å¤±è´¥çš„æµ‹è¯•

```bash
# åªè¿è¡Œæ–°æµ‹è¯•
pytest tests/test_new_feature.py -v

# æˆ–å…³é”®å­—è¿‡æ»¤
pytest -k "test_new_function" -v
```

**Git**ï¼š`git commit -m "test: æ·»åŠ  xxx åŠŸèƒ½çš„å¤±è´¥æµ‹è¯•"`

### 1.2 ğŸŸ¢ ç»¿ - ç¼–å†™æœ€å°‘ä»£ç ä½¿æµ‹è¯•é€šè¿‡

```bash
# åªè¿è¡Œå½“å‰åŠŸèƒ½æµ‹è¯•
pytest tests/test_new_feature.py -v
```

**Git**ï¼š`git commit -m "feat: å®ç°ä½¿æµ‹è¯•é€šè¿‡çš„ xxx åŠŸèƒ½"`

### 1.3 â™»ï¸ é‡æ„ - åœ¨æµ‹è¯•ä¿æŠ¤ä¸‹ä¼˜åŒ–ä»£ç 

```bash
# è¿è¡Œå—å½±å“çš„æ¨¡å—æµ‹è¯•
pytest tests/test_module.py -v
```

**Git**ï¼š`git commit -m "refactor: é‡æ„ xxx åŠŸèƒ½ä»£ç "`

---

## 2. æµ‹è¯•è¿è¡Œç­–ç•¥

| åœºæ™¯ | å‘½ä»¤ |
|------|------|
| å¼€å‘å•ä¸ªåŠŸèƒ½ | `pytest tests/test_xxx.py` |
| è°ƒè¯•ç‰¹å®šæµ‹è¯• | `pytest -k "test_login"` |
| é‡è·‘å¤±è´¥æµ‹è¯• | `pytest --lf` |
| å¤±è´¥ä¼˜å…ˆ | `pytest --ff` |
| æŒ‰ç±»å‹è¿è¡Œ | `pytest -m unit` |

**æäº¤å‰éªŒè¯**ï¼š`pytest && uv run ruff check && uv run mypy .`

---

## 3. æµ‹è¯•è§„èŒƒï¼ˆç®€è¿°ï¼‰

| è§„èŒƒ | è¦æ±‚ |
|------|------|
| **AAA æ¨¡å¼** | Arrangeï¼ˆå‡†å¤‡ï¼‰â†’ Actï¼ˆæ‰§è¡Œï¼‰â†’ Assertï¼ˆæ–­è¨€ï¼‰ |
| **å‘½åè§„èŒƒ** | `test_<åŠŸèƒ½>_<æ¡ä»¶>_<æœŸæœ›>` |
| **å•ä¸€èŒè´£** | ä¸€ä¸ªæµ‹è¯•ä¸€ä¸ªè¡Œä¸ºï¼Œâ‰¤20 è¡Œ |
| **æµ‹è¯•é‡‘å­—å¡”** | å•å…ƒ 70% / é›†æˆ 20% / E2E 10% |
| **Mock è§„åˆ™** | åªéš”ç¦»å¤–éƒ¨ä¾èµ–ï¼ˆAPI/DB/æ–‡ä»¶ç³»ç»Ÿï¼‰ |
| **è¦†ç›–ç‡** | æ ¸å¿ƒ â‰¥80%ï¼Œæ•´ä½“ â‰¥70% |

---

## 4. æ€§èƒ½ä¼˜åŒ–

### 4.1 å¢é‡æµ‹è¯•

| æŠ€å·§ | å‘½ä»¤ |
|------|------|
| æŒ‡å®šæ–‡ä»¶ | `pytest tests/test_user.py` |
| å…³é”®å­—è¿‡æ»¤ | `pytest -k "login"` |
| Marker åˆ†ç»„ | `pytest -m unit` |
| å¹¶è¡Œæ‰§è¡Œ | `pytest -n auto` |
| å¤±è´¥é‡è·‘ | `pytest --lf` |

### 4.2 åŠ é€Ÿå‘½ä»¤

```bash
pytest -n auto          # å¹¶è¡Œæ‰§è¡Œï¼ˆéœ€ pytest-xdistï¼‰
pytest --lf             # åªè¿è¡Œä¸Šæ¬¡å¤±è´¥çš„
pytest --ff             # å…ˆè¿è¡Œå¤±è´¥çš„
pytest -x               # ç¬¬ä¸€ä¸ªå¤±è´¥ååœæ­¢
pytest --durations=10   # æ˜¾ç¤ºæœ€æ…¢çš„ 10 ä¸ªæµ‹è¯•
```

### 4.3 Mock å¤–éƒ¨ä¾èµ–

```python
# âŒ æ…¢ï¼šçœŸå®æ•°æ®åº“è°ƒç”¨
def test_get_user():
    user = db.query(User, 1)  # æ…¢ï¼
    assert user.name == "Alice"

# âœ… å¿«ï¼šMock æ•°æ®åº“
def test_get_user(mock_db):
    mock_db.return_value = User(id=1, name="Alice")
    user = get_user(1)
    assert user.name == "Alice"
```

---

## 5. é—ç•™ä»£ç å¤„ç†

1. å…ˆè¡¥å……æµ‹è¯•ï¼ˆæµ‹è¯•å…ˆè¡Œé‡æ„ï¼‰
2. è¿è¡Œæµ‹è¯•ç¡®è®¤é€šè¿‡
3. å†è¿›è¡Œä¿®æ”¹

```bash
pytest tests/test_legacy.py -v
git commit -m "test: è¡¥å……é—ç•™ä»£ç çš„æµ‹è¯•"
```

---

## 6. Git æäº¤è§„èŒƒ

| é˜¶æ®µ | å‰ç¼€ | ç¤ºä¾‹ |
|------|------|------|
| çº¢ï¼ˆæµ‹è¯•ï¼‰ | `test:` | `test: æ·»åŠ ç”¨æˆ·ç™»å½•çš„å¤±è´¥æµ‹è¯•` |
| ç»¿ï¼ˆå®ç°ï¼‰ | `feat:` | `feat: å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½` |
| é‡æ„ | `refactor:` | `refactor: ä¼˜åŒ–ç™»å½•éªŒè¯é€»è¾‘` |
| ä¿®å¤ | `fix:` | `fix: ä¿®å¤ç™»å½•éªŒè¯ bug` |

---

## 7. çŠ¶æ€æŠ¥å‘Š

```markdown
## å½“å‰çŠ¶æ€
**é˜¶æ®µ**ï¼š[ğŸ”´ çº¢ / ğŸŸ¢ ç»¿ / â™»ï¸ é‡æ„]

## æµ‹è¯•ç»“æœ
- è¿è¡Œï¼š`pytest tests/test_xxx.py`
- ç»“æœï¼šé€šè¿‡/å¤±è´¥

## Git æäº¤
- `test/feat/refactor: æè¿°`

## ä¸‹ä¸€æ­¥
ç»§ç»­å®ç° / é‡æ„ / æäº¤éªŒè¯
```

---

**å¿«é€Ÿåé¦ˆ â†’ å¿«é€Ÿè¿­ä»£ â†’ é«˜è´¨é‡ä»£ç **
